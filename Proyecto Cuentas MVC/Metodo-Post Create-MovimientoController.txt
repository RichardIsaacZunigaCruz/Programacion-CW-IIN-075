// POST: Movimiento/Create
// To protect from overposting attacks, enable the specific properties you want to bind to.
// For more details, see http://go.microsoft.com/fwlink/?LinkId=317598.
[HttpPost]
[ValidateAntiForgeryToken]
public async Task<IActionResult> Create([Bind("Id,Tipo,Concepto,Monto,Fecha,IdCuenta")] Movimiento movimiento)
{
    if (ModelState.IsValid)
    { 
       
    _context.Add(movimiento);
        var cuenta = await _context.Cuenta
            .FirstOrDefaultAsync(m => m.Id == movimiento.IdCuenta);

        if(cuenta != null)
    {   
          if(movimiento.Tipo ==1)
                {
                cuenta.setCredito(movimiento.Monto);
            }
            else
            {
                cuenta.setDebito(movimiento.Monto);
            }
                cuenta.setBalance();
                _context.Update(cuenta);
    }
    
    await _context.SaveChangesAsync();
        return RedirectToAction(nameof(Index));
    }
    return View(movimiento);
}
